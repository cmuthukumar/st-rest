---
- name: Setting up User Variables
  hosts: localhost
  connection: local
  tasks:
    - name: Convert to JSOn
      set_fact:
          cp_user_vars: "{{do_vars|from_json}}" 
      
    - name: Print Server integrations Values
      debug: msg="Servers integrations Values {{cp_user_vars}}"

    # - name: Print Servers    
      # debug: msg="Servers  Values {{cp_user_vars[2].AS2[0]['Total Hosts']}}"
      # with_items: "{{cp_user_vars[0]|default([])}}"

    - name: "Create Servers and TPNodes Files"
      template: src="{{playbook_dir}}/templates/{{cloud_provider}}/{{item}}.j2" dest="{{playbook_dir}}/files/{{cloud_provider}}/{{item}}"
      with_items: 
            - "servers.yml"
            - "tpnodes.yml"