---
# tasks file for install.deps

# - name: Install EPEL Repo.
  # yum:
    # name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm
    # state: present

# - name: Import EPEL GPG key.
  # rpm_key:
    # key: /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}
    # state: present
    
- name: Install EPEL Repository
  yum:
    name: epel-release
    state: present
  register: epel_status
  retries: 3
  delay: 5
  until: epel_status|success      
 
- name: "Install Development tools,unzip,python-lxml,rng-tools,python-jinja2 service on {{inventory_hostname}} host"
  yum:
    name: "{{item}}"
    state: present
  with_items:
        - "@Development tools"
        - unzip
        - "python-lxml"
        - "rng-tools"
        - "python-jinja2"
        - rsync 
  register: pkg_install
  retries: 3
  delay: 5
  until: pkg_install|success
 
- name: Update /etc/hosts from inventory
  lineinfile: dest=/etc/hosts regexp='.*{{inventory_hostname}}$' line="{{ansible_default_ipv4.address}} {{inventory_hostname}}" state=present
  register: etc_status
  retries: 3
  delay: 2
  until: etc_status|success
  
- name: "Restart rngd,sshd,network service on {{inventory_hostname}} host"
  service:
    name: "{{item}}"
    state: restarted
  with_items:
        - rngd
        - sshd
        - network
  register: service_status
  retries: 3
  delay: 5
  until: service_status|success           

- name: Wait for SSH to come up
  wait_for: host="{{ansible_ssh_host}}" port=22 delay=20 timeout=100 state=started
  delegate_to: localhost
  
  # - name: Install libxslt-devel package for running bin file in CentOS
  # yum: name="{{item}}" state=present
  # with_items:
        # - libxml2 
        # - libxml2-devel
        # - libxslt
        # - libxslt-devel
        # - python-devel
        # - gcc
        # - gcc-c++
        # - kernel-devel
        # - python-pip
        
# - name: Install python-devel package for running bin file in CentOS
  # yum: name=python-devel state=present
  
     
# - name: Checking Python 2.7 available or not in Linux Systems
  # shell: python --version
  # register: py_version
  
# - debug: msg="Pre Tasks Completed::{{py_version}}"  

# - name: "Install python2.7 With Deps"
  # include_tasks: "install_centos_py27.yml"
  # when: ansible_distribution_version | int >= 9

# - name: Install Pip and lxml Deps using YUM
  # yum: name="{{item}}" state=present 
  # with_items:
    # - libxml2 
    # - libxml2-devel
    # - libxslt
    # - libxslt-devel
    # - python-devel
    # - gcc
    # - gcc-c++
    # - kernel-devel
    # - python-pip
  # register: lxm_deps
  # retries: 3
  # delay: 2
  # until: lxm_deps|success
  
# - name: Install lxml using pip
  # pip: 
    # name: lxml
    # version: 3.2.1
  # environment:
    # PATH: "/usr/bin/python2.7:{{ ansible_env.PATH }}"
  # register: lxml_status
  # retries: 3
  # delay: 2
  # until: lxml_status|success

# - name: Install Jinja2 using pip
  # pip: 
    # name: jinja2
  # register: jinja_status
  # retries: 3
  # delay: 2
  # until: jinja_status|success
  
# - name: install the latest version of rsync
  # yum:
    # name: rsync
  # register: rsync_status  
  # retries: 3
  # delay: 2
  # until: rsync_status|success   