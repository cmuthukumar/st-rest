---
 # - name: Setting Dictionary Name for Proxy Inside
   # set_fact:
      # versalex: "{{conf_tp.value}}"
 
 - name: Set Dataset Key 
   set_fact:
        dset_key: "{{conf_dataset.key}}"
        
 - name: Copy SetupOptions Jar File to remote location
   copy: src="{{playbook_dir}}/library/" dest="{{versalex.install_location}}lib/"
         
 # - name: Copy SetupOptions Jar File to remote location
   # copy: src="/root/workspace/EFSS/non-shipped/test/automation/systemtesting/setup_versalex/target/systest_jars-0.1-SNAPSHOT.jar" dest="{{versalex.install_location}}/SetupTestProfile.jar"

 - name: Create Import Location Directory, if not Exists
   file: path="{{versalex.install_location}}systestcerts" state=directory
   # when: node_type == 'Receiver'
 - name: Copy All Certs from Local to Remote Import Location
   synchronize: src="{{playbook_dir}}/res/systestcerts/" dest="{{versalex.install_location}}systestcerts/"   
   # when: setup_profiles.vex_product is defined and setup_profiles.vex_product != 'VLProxy' and setup_profiles.node_type == 'Receiver'   
 - name: "Configure Test Profiles in Remote Machines for Receiver/TP Side"
   shell: jre/bin/java -cp $CLASSPATH com.cleo.systest.SetupTestProfile "{{versalex.name}}" "{{versalex.install_location}}" "{{item.name}}" "{{item.hr}}" "{{item.mailbox_range}}" "{{item.action_range}}" "{{item.ip}}" "5080"  "" "{{item.host_custom_props}}" "{{item.mailbox_custom_props}}" "{{item.action_custom_props}}" "{{item.create_certs}}"
   environment:
     CLASSPATH: ":{{versalex.install_location}}SetupTestProfile.jar:{{versalex.install_location}}lib/*:{{versalex.install_location}}lib/help/*:{{versalex.install_location}}lib/hibernate/*:{{versalex.install_location}}lib/secureshare/*:{{versalex.install_location}}webserver/AjaxSwing/lib/*:{{versalex.install_location}}lib/json/*"
   args:
     executable: /bin/sh
     chdir: "{{versalex.install_location}}"
   with_items: "{{ dataset[dset_key]  }}"
   register: profile_config      
   # when: setup_profiles.vex_product is defined and setup_profiles.vex_product != 'VLProxy' and setup_profiles.node_type == 'Receiver'